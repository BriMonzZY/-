C51 COMPILER V9.60.0.0   KEY                                                               01/26/2021 11:39:10 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE KEY
OBJECT MODULE PLACED IN ..\output\key.obj
COMPILER INVOKED BY: D:\app\keil\C51\BIN\C51.EXE ..\files\key.c LARGE OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(
                    -.\Listings\key.lst) TABS(2) OBJECT(..\output\key.obj)

line level    source

   1          #include "config.h"
   2          #include "key.h"
   3          #include "smg.h"
   4          #include "main.h"
   5          #include "app.h"
   6          
   7          uchar KeySta[4][4] = { //È«²¿¾ØÕó°´¼üµÄµ±Ç°×´Ì¬
   8              {1, 1, 1, 1}, {1, 1, 1, 1}, {1, 1, 1, 1}, {1, 1, 1, 1}
   9          };
  10          uchar keyvalue = 0;
  11          
  12          
  13          /*¶¨Ê±Æ÷ÖÐ¶Ï0³õÊ¼»¯º¯Êý*/
  14          void timer0Init()
  15          {
  16   1          EA = 1;
  17   1          TMOD = 0x01; //ÉèÖÃ T0 ÎªÄ£Ê½ 1
  18   1          TH0 = 0xfc; //Îª T0 ¸³³õÖµ 0xFC67£¬¶¨Ê± 1ms
  19   1          TL0 = 0x66;
  20   1          ET0 = 1; //Ê¹ÄÜ T0 ÖÐ¶Ï
  21   1          TR0 = 1; //Æô¶¯ T0
  22   1      }
  23          
  24          void timer1Init() {
  25   1        TMOD |= 0x10;//ÉèÖÃ¶¨Ê±Æ÷16Î»¶¨Ê±Æ÷
  26   1        TH1 = 0xee;
  27   1        TL1 = 0x00; //ÉèÖÃ5ms
  28   1        ET1 = 1;
  29   1        TR1 = 1;
  30   1      }
  31          
  32          void keydriver() { 
  33   1        uchar i, j, gg;//Ñ­»·±äÁ¿
  34   1        for (i=0; i<4; i++){
  35   2          for (j=0; j<4; j++){
  36   3              if (backup[i][j] != KeySta[i][j]){//¼ì²â°´¼ü¶¯×÷
  37   4                if (backup[i][j] != 0){ //
  38   5                  keyvalue = i * 4 + j;
  39   5                  KeyAction(keyvalue);
  40   5                }//if (backup[i][j] != 0) °´¼ü°´ÏÂÊ±Ö´ÐÐ¶¯×÷
  41   4                backup[i][j] = KeySta[i][j]; //¸üÐÂÇ°Ò»´ÎµÄ±¸·ÝÖµ
  42   4              }
  43   3          }
  44   2        }
  45   1      }
*** WARNING C280 IN LINE 33 OF ..\files\key.c: 'gg': unreferenced local variable
  46          
  47          
  48          void keyscan() { //ÔÚÖÐ¶ÏÖÐµ÷ÓÃ
  49   1         uchar m;
  50   1          static uchar keyout = 0; //¾ØÕó°´¼üÉ¨ÃèÊä³öË÷Òý
  51   1          
  52   1          static uchar keybuf[4][4] = { //¾ØÕó°´¼üÉ¨Ãè»º³åÇø
  53   1              {0xFF, 0xFF, 0xFF, 0xFF}, {0xFF, 0xFF, 0xFF, 0xFF},
C51 COMPILER V9.60.0.0   KEY                                                               01/26/2021 11:39:10 PAGE 2   

  54   1              {0xFF, 0xFF, 0xFF, 0xFF}, {0xFF, 0xFF, 0xFF, 0xFF}
  55   1          };
  56   1        
  57   1        
  58   1        /*Ïû¶¶²¢¸üÐÂ°´¼ü×´Ì¬*/
  59   1        //½«Ò»ÐÐµÄ 4 ¸ö°´¼üÖµÒÆÈë»º³åÇø
  60   1        keybuf[keyout][0] = (keybuf[keyout][0] << 1) | KEY_IN_1;
  61   1        keybuf[keyout][1] = (keybuf[keyout][1] << 1) | KEY_IN_2;
  62   1        keybuf[keyout][2] = (keybuf[keyout][2] << 1) | KEY_IN_3;
  63   1        keybuf[keyout][3] = (keybuf[keyout][3] << 1) | KEY_IN_4;
  64   1        //Ïû¶¶ºó¸üÐÂ°´¼ü×´Ì¬
  65   1        for (m = 0; m < 4; m++){ //Ã¿ÐÐ 4 ¸ö°´¼ü£¬ËùÒÔÑ­»· 4 ´Î
  66   2            if ((keybuf[keyout][m] & 0x0F) == 0x00){    //Á¬Ðø 4 ´ÎÉ¨ÃèÖµÎª 0£¬¼´ 4*4ms ÄÚ¶¼ÊÇ°´ÏÂ×´Ì¬Ê±£¬¿ÉÈÏÎª°´¼
             -üÒÑÎÈ¶¨µÄ°´ÏÂ
  67   3                KeySta[keyout][m] = 0;
  68   3            }
  69   2            else if ((keybuf[keyout][m] & 0x0F) == 0x0F){    //Á¬Ðø 4 ´ÎÉ¨ÃèÖµÎª 1£¬¼´ 4*4ms ÄÚ¶¼ÊÇµ¯Æð×´Ì¬Ê±£¬¿ÉÈÏ
             -Îª°´¼üÒÑÎÈ¶¨µÄµ¯Æð
  70   3                KeySta[keyout][m] = 1;
  71   3            }
  72   2        }
  73   1        
  74   1        /*½øÐÐ¾ØÕó°´¼üÉ¨Ãè*/
  75   1        //Ö´ÐÐÏÂÒ»´ÎµÄÉ¨ÃèÊä³ö
  76   1        keyout++; //Êä³öË÷ÒýµÝÔö
  77   1        keyout = keyout & 0x03; //Ë÷ÒýÖµ¼Óµ½ 4 ¼´¹éÁã
  78   1        switch (keyout){ //¸ù¾ÝË÷Òý£¬ÊÍ·Åµ±Ç°Êä³öÒý½Å£¬À­µÍÏÂ´ÎµÄÊä³öÒý½Å
  79   2            case 0: KEY_OUT_4 = 1; KEY_OUT_1 = 0; break;
  80   2            case 1: KEY_OUT_1 = 1; KEY_OUT_2 = 0; break;
  81   2            case 2: KEY_OUT_2 = 1; KEY_OUT_3 = 0; break;
  82   2            case 3: KEY_OUT_3 = 1; KEY_OUT_4 = 0; break;
  83   2            default: break;
  84   2        }
  85   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    568    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     34       3
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
