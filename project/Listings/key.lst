C51 COMPILER V9.60.0.0   KEY                                                               01/25/2021 22:55:07 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE KEY
OBJECT MODULE PLACED IN ..\output\key.obj
COMPILER INVOKED BY: D:\app\keil\C51\BIN\C51.EXE ..\files\key.c LARGE OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(
                    -.\Listings\key.lst) TABS(2) OBJECT(..\output\key.obj)

line level    source

   1          #include "config.h"
   2          #include "key.h"
   3          #include "smg.h"
   4          
   5          
   6          uchar KeySta[4][4] = { //È«²¿¾ØÕó°´¼üµÄµ±Ç°×´Ì¬
   7              {1, 1, 1, 1}, {1, 1, 1, 1}, {1, 1, 1, 1}, {1, 1, 1, 1}
   8          };
   9          uchar keyvalue = 0;
  10          
  11          
  12          /*¶¨Ê±Æ÷ÖÐ¶Ï0³õÊ¼»¯º¯Êý*/
  13          void timer0Init()
  14          {
  15   1          EA = 1;
  16   1          TMOD = 0x01; //ÉèÖÃ T0 ÎªÄ£Ê½ 1
  17   1          TH0 = 0xfc; //Îª T0 ¸³³õÖµ 0xFC67£¬¶¨Ê± 1ms
  18   1          TL0 = 0x66;
  19   1          ET0 = 1; //Ê¹ÄÜ T0 ÖÐ¶Ï
  20   1          TR0 = 1; //Æô¶¯ T0
  21   1      }
  22          
  23          uchar keydriver() {
  24   1        
  25   1        uchar backup[4][4];
  26   1        uchar i, j, gg;
  27   1        
  28   1        
  29   1        for (i=0; i<4; i++){
  30   2          for (j=0; j<4; j++){
  31   3              if (backup[i][j] != KeySta[i][j]){//¼ì²â°´¼ü¶¯×÷
  32   4                if (backup[i][j] != 0){ //
  33   5                  keyvalue = i * 4 + j;
  34   5                  
  35   5                }//if (backup[i][j] != 0) °´¼ü°´ÏÂÊ±Ö´ÐÐ¶¯×÷
  36   4                backup[i][j] = KeySta[i][j]; //¸üÐÂÇ°Ò»´ÎµÄ±¸·ÝÖµ
  37   4              }
  38   3          }
  39   2        }
  40   1        return keyvalue;
  41   1      }
*** WARNING C280 IN LINE 26 OF ..\files\key.c: 'gg': unreferenced local variable
  42          
  43          
  44          void keyscan() {
  45   1         uchar m;
  46   1          static uchar keyout = 0; //¾ØÕó°´¼üÉ¨ÃèÊä³öË÷Òý
  47   1          
  48   1          static uchar keybuf[4][4] = { //¾ØÕó°´¼üÉ¨Ãè»º³åÇø
  49   1              {0xFF, 0xFF, 0xFF, 0xFF}, {0xFF, 0xFF, 0xFF, 0xFF},
  50   1              {0xFF, 0xFF, 0xFF, 0xFF}, {0xFF, 0xFF, 0xFF, 0xFF}
  51   1          };
  52   1        
  53   1        
C51 COMPILER V9.60.0.0   KEY                                                               01/25/2021 22:55:07 PAGE 2   

  54   1        /*Ïû¶¶²¢¸üÐÂ°´¼ü×´Ì¬*/
  55   1        //½«Ò»ÐÐµÄ 4 ¸ö°´¼üÖµÒÆÈë»º³åÇø
  56   1        keybuf[keyout][0] = (keybuf[keyout][0] << 1) | KEY_IN_1;
  57   1        keybuf[keyout][1] = (keybuf[keyout][1] << 1) | KEY_IN_2;
  58   1        keybuf[keyout][2] = (keybuf[keyout][2] << 1) | KEY_IN_3;
  59   1        keybuf[keyout][3] = (keybuf[keyout][3] << 1) | KEY_IN_4;
  60   1        //Ïû¶¶ºó¸üÐÂ°´¼ü×´Ì¬
  61   1        for (m = 0; m < 4; m++){ //Ã¿ÐÐ 4 ¸ö°´¼ü£¬ËùÒÔÑ­»· 4 ´Î
  62   2            if ((keybuf[keyout][m] & 0x0F) == 0x00){    //Á¬Ðø 4 ´ÎÉ¨ÃèÖµÎª 0£¬¼´ 4*4ms ÄÚ¶¼ÊÇ°´ÏÂ×´Ì¬Ê±£¬¿ÉÈÏÎª°´¼
             -üÒÑÎÈ¶¨µÄ°´ÏÂ
  63   3                KeySta[keyout][m] = 0;
  64   3            }
  65   2            else if ((keybuf[keyout][m] & 0x0F) == 0x0F){    //Á¬Ðø 4 ´ÎÉ¨ÃèÖµÎª 1£¬¼´ 4*4ms ÄÚ¶¼ÊÇµ¯Æð×´Ì¬Ê±£¬¿ÉÈÏ
             -Îª°´¼üÒÑÎÈ¶¨µÄµ¯Æð
  66   3                KeySta[keyout][m] = 1;
  67   3            }
  68   2        }
  69   1        
  70   1        /*½øÐÐ¾ØÕó°´¼üÉ¨Ãè*/
  71   1        //Ö´ÐÐÏÂÒ»´ÎµÄÉ¨ÃèÊä³ö
  72   1        keyout++; //Êä³öË÷ÒýµÝÔö
  73   1        keyout = keyout & 0x03; //Ë÷ÒýÖµ¼Óµ½ 4 ¼´¹éÁã
  74   1        switch (keyout){ //¸ù¾ÝË÷Òý£¬ÊÍ·Åµ±Ç°Êä³öÒý½Å£¬À­µÍÏÂ´ÎµÄÊä³öÒý½Å
  75   2            case 0: KEY_OUT_4 = 1; KEY_OUT_1 = 0; break;
  76   2            case 1: KEY_OUT_1 = 1; KEY_OUT_2 = 0; break;
  77   2            case 2: KEY_OUT_2 = 1; KEY_OUT_3 = 0; break;
  78   2            case 3: KEY_OUT_3 = 1; KEY_OUT_4 = 0; break;
  79   2            default: break;
  80   2        }
  81   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    511    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     34      17
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
